@model Shield.Ui.App.ViewModels.AssignedAEViewModel

<div class="card" style="padding:1.5rem 1rem 1.5rem 1rem;" >
    <h3 style="border-bottom:2px solid #eceeef; padding-bottom: 0.75rem; margin-bottom: 2.25rem;">Warning</h3>

    <p>User @Model.AssignedAE?.DisplayName (@Model.AssignedAE?.BemsId) is already assigned as AE in the LOTO @Model.LotoId.</p>

    <hr />

    <div class="text-center">
        <button type="button" onclick="onReturn()" class="btn btn-secondary-gray btn-rounded">
            <i class="fa fa-arrow-left prefix" style="margin-right:0.5rem;"></i>Return
        </button>
    </div>
</div>

function signInAE(id, bemsOrBadge, overrideTraining) {
    $('#overrideTrainingLotoModal').hide();
    closeIdentityPopupForLotoSignIn();

    let $signInLoader = $('#sign-in-loader');
    $signInLoader.css('display', 'inline');

    let overrideLoader = $('#override-sign-in-loader');
    overrideLoader.css('display', 'inline');

    $.ajax({
        url: "/Loto/AssignAE",
        type: 'POST',
        data: {
            lotoId: id,
            bemsOrBadge: bemsOrBadge,
            overrideTraining: overrideTraining
        },
        dataType: 'json',
        cache: false,
        success: function (result) {
            if (result.status === HTTP.STATUS.SUCCESS) {
                $.ajax({
                    url: "/Loto/LotoDetail?id=" + id,
                    cache: false,
                    success: function (html) {
                        $('body').html(safeResponseFilter(html)); // refresh content
                        toastr.success(safeResponseFilter(result.message), "AE Signed In", TOAST_OPTIONS_SHORT_TIMEOUT);
                    }
                });
            } else if (result.status === HTTP.STATUS.NOT_MODIFIED) {
                if (result.reason === HTTP.REASON.TRAINING) {
                    let userTrainingData = result.data.userTrainingData;
                    $.ajax({
                        url: '/Loto/GetTrainingStatus?id=' + id + '&bemsId=' + result.data.aeBemsId + '&message=' + result.message,
                        type: 'POST',
                        data: JSON.stringify(userTrainingData),
                        contentType: 'application/json; charset=utf-8',
                        dataType: 'html',
                        success: function (response) {
                            $('#overrideTrainingLotoModal').html(response); 
                            $('#OverrideTrainingLotoConfirmation').append(safeResponseFilter('<br /><br /> Shield attempted to communicate with My Learning and was unable to provide confirmation of required training (77517 and 84757). Please document a reason for an override or cancel the sign in.'));
                            $('#overrideTrainingBemsID').val(bemsOrBadge);
                            $('#override-employee-training').show();
                            $('#OverrideTrainingSubmit').show();
                            $('#override-visitor-training').hide();
                            $('#OverrideTrainingVisitorSubmit').hide();
                            $('#OverrideTrainingPAESubmit').hide();
                            $('#overrideTrainingLotoModal').modal('show');
                        }
                    });

                } else if (result.reason === HTTP.REASON.ALREADY_EXISTS) {
                    $("#already-signed-in-message").html(safeResponseFilter(result.message));
                    $("#cannotSignIntoLotoModal").modal("show");
                } else {
                    toastr.error(result.message, "AE Not Signed In", TOAST_OPTIONS);
                }
            } else {
                if (result.reason === HTTP.REASON.TRAINING) {
                    $('#sign-in-partial').hide(200);
                    $('#sign-in-partial').html('');

                    $.ajax({
                        url: '/Loto/OverrideTrainingPartial',
                        type: 'POST',
                        data: {
                            id: result.data.lotoId,
                            bemsId: result.data.aeBemsId,
                            message: result.message,
                            aeName: result.AEName,
                            isTrainingDown: true
                        },
                        dataType: 'html',
                        async: true,
                        success: function (result) {
                            $('#sign-in-partial').html(result);
                            $('#sign-in-partial').show(200);
                        }
                    });
                } else {
                    $('#overrideTrainingLotoModal').hide();
                    toastr.error(result.message, "AE Not Signed In", TOAST_OPTIONS);
                }
            }
        },
        error: function (xhr) {
            $('#overrideTrainingLotoModal').hide();
            toastr.error("Unable to connect to LOTO service.", "Connection Error", TOAST_OPTIONS);
        },
        complete: function () {
            $signInLoader.hide();
        },
        async: true
    });
}

This is old javascript function where for Reason - Already_exists we are returning the modal to prevent an AE to sign into multiple lotos.

Now i have done several changes . I have given the above code just to remember what was there previously ok
